From 3656a2b19f1af2f4502c552f04609f81eeda38c6 Mon Sep 17 00:00:00 2001
From: Vladislav Nepogodin <nepogodin.vlad@gmail.com>
Date: Mon, 12 Sep 2022 23:34:36 +0400
Subject: [PATCH 1/3] [locale] Remove breaking character ('\')

---
 src/modules/locale/Config.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/modules/locale/Config.cpp b/src/modules/locale/Config.cpp
index 8167aaec2c..6c302a29f0 100644
--- a/src/modules/locale/Config.cpp
+++ b/src/modules/locale/Config.cpp
@@ -60,7 +60,9 @@ loadLocales( const QString& localeGenPath )
         const auto lines = ba.split( '\n' );
         for ( const QByteArray& line : lines )
         {
-            localeGenLines.append( QString::fromLatin1( line.simplified() ) );
+            QString genLine = QString::fromLatin1( line.simplified() );
+            genLine.remove( "\\" );
+            localeGenLines.append( genLine );
         }
     }
     else

From 8c20503cfa53ce4d96d4458d8d14bcbf0cc0e993 Mon Sep 17 00:00:00 2001
From: Vladislav Nepogodin <nepogodin.vlad@gmail.com>
Date: Mon, 12 Sep 2022 23:54:13 +0400
Subject: [PATCH 2/3] [locale] Remove trailing whitespace

---
 src/modules/locale/Config.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/modules/locale/Config.cpp b/src/modules/locale/Config.cpp
index 6c302a29f0..eed7dc8e75 100644
--- a/src/modules/locale/Config.cpp
+++ b/src/modules/locale/Config.cpp
@@ -61,8 +61,8 @@ loadLocales( const QString& localeGenPath )
         for ( const QByteArray& line : lines )
         {
             QString genLine = QString::fromLatin1( line.simplified() );
-            genLine.remove( "\\" );
-            localeGenLines.append( genLine );
+            genLine.remove( '\\' );
+            localeGenLines.append( genLine.simplified() );
         }
     }
     else

From 447023fccf06fddb73402a5390b9b15a2c133860 Mon Sep 17 00:00:00 2001
From: Vladislav Nepogodin <nepogodin.vlad@gmail.com>
Date: Tue, 13 Sep 2022 00:46:22 +0400
Subject: [PATCH 3/3] [locale] Skip invalid lines

the format should be 'ur_PK UTF-8', instead of
'ur_PK/UTF-8 \' like in SUPPORTED file.
---
 src/modules/locale/Config.cpp | 17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)

diff --git a/src/modules/locale/Config.cpp b/src/modules/locale/Config.cpp
index eed7dc8e75..e9280583bf 100644
--- a/src/modules/locale/Config.cpp
+++ b/src/modules/locale/Config.cpp
@@ -60,9 +60,24 @@ loadLocales( const QString& localeGenPath )
         const auto lines = ba.split( '\n' );
         for ( const QByteArray& line : lines )
         {
+            if ( line.startsWith( "## " ) || line.startsWith( "# " ) || line.simplified() == "#" || line.startsWith( "SUPPORTED-LOCALES" ) )
+            {
+                continue;
+            }
+
             QString genLine = QString::fromLatin1( line.simplified() );
             genLine.remove( '\\' );
-            localeGenLines.append( genLine.simplified() );
+            genLine = genLine.simplified();
+
+            if ( genLine.isEmpty() )
+            {
+                continue;
+            }
+
+            genLine.replace( '/' , ' ' );
+            genLine = genLine.simplified();
+
+            localeGenLines.append( genLine );
         }
     }
     else
